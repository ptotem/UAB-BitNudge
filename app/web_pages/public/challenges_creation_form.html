<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta charset="utf-8"/>
    <title>BitNudge</title>

    <meta name="description" content="Draggabble Widget Boxes &amp; Containers"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>

    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="assets/css/font-awesome.min.css"/>

    <!-- page specific plugin styles -->
    <link rel="stylesheet" href="assets/css/jquery-ui.custom.min.css"/>
    <link rel="stylesheet" href="assets/css/datepicker.css" />

    <!-- text fonts -->
    <link rel="stylesheet" href="assets/css/ace-fonts.css"/>

    <!-- ace styles -->
    <link rel="stylesheet" href="assets/css/ace.min.css" id="main-ace-style"/>

    <!--[if lte IE 9]>
    <link rel="stylesheet" href="assets/css/ace-part2.min.css"/>
    <![endif]-->
    <link rel="stylesheet" href="assets/css/ace-skins.min.css"/>
    <link rel="stylesheet" href="assets/css/ace-rtl.min.css"/>

    <!--[if lte IE 9]>
    <link rel="stylesheet" href="assets/css/ace-ie.min.css"/>
    <![endif]-->

    <!-- inline styles related to this page -->

    <!-- ace settings handler -->
    <script src="assets/js/ace-extra.min.js"></script>

    <!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

    <!--[if lte IE 8]>
    <script src="assets/js/html5shiv.min.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->
</head>

<body class="no-skin">
<!-- #section:basics/navbar.layout -->
<div id="navbar" class="navbar navbar-default">
<script type="text/javascript">
    try {
        ace.settings.check('navbar', 'fixed')
    } catch (e) {
    }
</script>

<div class="navbar-container" id="navbar-container">
<!-- #section:basics/sidebar.mobile.toggle -->
<button type="button" class="navbar-toggle menu-toggler pull-left" id="menu-toggler">
    <span class="sr-only">Toggle sidebar</span>

    <span class="icon-bar"></span>

    <span class="icon-bar"></span>

    <span class="icon-bar"></span>
</button>

<!-- /section:basics/sidebar.mobile.toggle -->
<div class="navbar-header pull-left">
    <!-- #section:basics/navbar.layout.brand -->
    <a href="#" class="navbar-brand">
        <small>
            <i class="fa fa-leaf"></i>
            Ace Admin
        </small>
    </a>

    <!-- /section:basics/navbar.layout.brand -->

    <!-- #section:basics/navbar.toggle -->

    <!-- /section:basics/navbar.toggle -->
</div>

<!-- #section:basics/navbar.dropdown -->
<div class="navbar-buttons navbar-header pull-right" role="navigation">
<ul class="nav ace-nav">
<!-- #section:basics/navbar.user_menu -->
<li class="light-blue">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">
        <img class="nav-user-photo" src="assets/avatars/user.jpg" alt="Jason's Photo"/>
								<span class="user-info">
									<small>Welcome,</small>
									<span id="user_name"></span>
								</span>

        <i class="ace-icon fa fa-caret-down"></i>
    </a>

    <ul class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
        <li>
            <a onclick="logout()">
                <i class="ace-icon fa fa-power-off"></i>
                Logout
            </a>
        </li>
    </ul>
</li>

<!-- /section:basics/navbar.user_menu -->
</ul>
</div>

<!-- /section:basics/navbar.dropdown -->
</div>
<!-- /.navbar-container -->
</div>

<!-- /section:basics/navbar.layout -->
<div class="main-container" id="main-container">
<script type="text/javascript">
    try {
        ace.settings.check('main-container', 'fixed')
    } catch (e) {
    }
</script>

<!-- #section:basics/sidebar -->
<div id="sidebar" class="sidebar                  responsive">
    <script type="text/javascript">
        try {
            ace.settings.check('sidebar', 'fixed')
        } catch (e) {
        }
    </script>

    <div class="sidebar-shortcuts" id="sidebar-shortcuts">
        <div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">
            <button class="btn btn-success">
                <i class="ace-icon fa fa-signal"></i>
            </button>

            <button class="btn btn-info">
                <i class="ace-icon fa fa-pencil"></i>
            </button>

            <!-- #section:basics/sidebar.layout.shortcuts -->
            <button class="btn btn-warning">
                <i class="ace-icon fa fa-users"></i>
            </button>

            <button class="btn btn-danger">
                <i class="ace-icon fa fa-cogs"></i>
            </button>

            <!-- /section:basics/sidebar.layout.shortcuts -->
        </div>

        <div class="sidebar-shortcuts-mini" id="sidebar-shortcuts-mini">
            <span class="btn btn-success"></span>

            <span class="btn btn-info"></span>

            <span class="btn btn-warning"></span>

            <span class="btn btn-danger"></span>
        </div>
    </div>
    <!-- /.sidebar-shortcuts -->

    <ul class="nav nav-list">
        <li>
            <a href="teams.html">
                <i class="menu-icon fa fa-tachometer"></i>
                <span class="menu-text">Team</span>
            </a>

            <b class="arrow"></b>
        </li>

        <li class="">
            <a href="employees.html">
                <i class="menu-icon fa fa-desktop"></i>
                <span class="menu-text"> Employees </span>
            </a>
            <b class="arrow"></b>
        </li>

        <li>
            <a href="job_roles.html">
                <i class="menu-icon fa fa-list"></i>
                <span class="menu-text">Job Roles</span>
            </a>

            <b class="arrow"></b>
        </li>

        <li class="">
            <a href="org_tags.html">
                <i class="menu-icon fa fa-pencil-square-o"></i>
                <span class="menu-text"> Organizational Tags </span>
            </a>
            <b class="arrow"></b>
        </li>

        <li>
            <a href="action_schemas.html">
                <i class="menu-icon fa fa-list-alt"></i>
                <span class="menu-text"> Action Schemas </span>
            </a>

            <b class="arrow"></b>
        </li>

        <li class="">
            <a href="levels.html">
                <i class="menu-icon fa fa-calendar"></i>
                <span class="menu-text"> Level </span>
            </a>
            <b class="arrow"></b>
        </li>

        <li class="">
            <a href="abilities.html">
                <i class="menu-icon fa fa-picture-o"></i>
                <span class="menu-text"> Abilities </span>
            </a>

            <b class="arrow"></b>
        </li>
        <li class="">
            <a href="badges.html">
                <i class="menu-icon fa fa-desktop"></i>
                <span class="menu-text"> Badges </span>
            </a>

            <b class="arrow"></b>
        </li>
        <li>
            <a href="roles.html">
                <i class="menu-icon fa fa-bar-chart-o"></i>
                <span class="menu-text"> Roles </span>
            </a>

            <b class="arrow"></b>
        </li>
        <li class="">
            <a href="goals.html">
                <i class="menu-icon fa fa-picture-o"></i>
                <span class="menu-text"> Goals </span>
            </a>

            <b class="arrow"></b>
        </li>
        <li class="">
            <a href="challenges.html">
                <i class="menu-icon fa fa-laptop"></i>
                <span class="menu-text"> Challenges </span>
            </a>

            <b class="arrow"></b>
        </li>
    </ul><!-- /.nav-list -->

    <!-- #section:basics/sidebar.layout.minimize -->
    <div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
        <i class="ace-icon fa fa-angle-double-left" data-icon1="ace-icon fa fa-angle-double-left"
           data-icon2="ace-icon fa fa-angle-double-right"></i>
    </div>

    <!-- /section:basics/sidebar.layout.minimize -->
    <script type="text/javascript">
        try {
            ace.settings.check('sidebar', 'collapsed')
        } catch (e) {
        }
    </script>
</div>

<!-- /section:basics/sidebar -->
<div class="main-content">
<!-- #section:basics/content.breadcrumbs -->
<div class="breadcrumbs" id="breadcrumbs">
    <script type="text/javascript">
        try {
            ace.settings.check('breadcrumbs', 'fixed')
        } catch (e) {
        }
    </script>


    <!-- /.breadcrumb -->

    <!-- #section:basics/content.searchbox -->

    <!-- /.nav-search -->

    <!-- /section:basics/content.searchbox -->
</div>

<!-- /section:basics/content.breadcrumbs -->
<div class="page-content">
<!-- #section:settings.box -->
<div class="ace-settings-container" id="ace-settings-container">
    <div class="btn btn-app btn-xs btn-warning ace-settings-btn" id="ace-settings-btn">
        <i class="ace-icon fa fa-cog bigger-150"></i>
    </div>

    <div class="ace-settings-box clearfix" id="ace-settings-box">
        <div class="pull-left width-50">
            <!-- #section:settings.skins -->
            <div class="ace-settings-item">
                <div class="pull-left">
                    <select id="skin-colorpicker" class="hide">
                        <option data-skin="no-skin" value="#438EB9">#438EB9</option>
                        <option data-skin="skin-1" value="#222A2D">#222A2D</option>
                        <option data-skin="skin-2" value="#C6487E">#C6487E</option>
                        <option data-skin="skin-3" value="#D0D0D0">#D0D0D0</option>
                    </select>
                </div>
                <span>&nbsp; Choose Skin</span>
            </div>

            <!-- /section:settings.skins -->

            <!-- #section:settings.navbar -->
            <div class="ace-settings-item">
                <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-navbar"/>
                <label class="lbl" for="ace-settings-navbar"> Fixed Navbar</label>
            </div>

            <!-- /section:settings.navbar -->

            <!-- #section:settings.sidebar -->
            <div class="ace-settings-item">
                <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-sidebar"/>
                <label class="lbl" for="ace-settings-sidebar"> Fixed Sidebar</label>
            </div>

            <!-- /section:settings.sidebar -->

            <!-- #section:settings.breadcrumbs -->
            <div class="ace-settings-item">
                <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-breadcrumbs"/>
                <label class="lbl" for="ace-settings-breadcrumbs"> Fixed Breadcrumbs</label>
            </div>

            <!-- /section:settings.breadcrumbs -->

            <!-- #section:settings.rtl -->
            <div class="ace-settings-item">
                <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-rtl"/>
                <label class="lbl" for="ace-settings-rtl"> Right To Left (rtl)</label>
            </div>

            <!-- /section:settings.rtl -->

            <!-- #section:settings.container -->
            <div class="ace-settings-item">
                <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-add-container"/>
                <label class="lbl" for="ace-settings-add-container">
                    Inside
                    <b>.container</b>
                </label>
            </div>

            <!-- /section:settings.container -->
        </div>
        <!-- /.pull-left -->

        <div class="pull-left width-50">
            <!-- #section:basics/sidebar.options -->
            <div class="ace-settings-item">
                <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-hover"/>
                <label class="lbl" for="ace-settings-hover"> Submenu on Hover</label>
            </div>

            <div class="ace-settings-item">
                <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-compact"/>
                <label class="lbl" for="ace-settings-compact"> Compact Sidebar</label>
            </div>

            <div class="ace-settings-item">
                <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-highlight"/>
                <label class="lbl" for="ace-settings-highlight"> Alt. Active Item</label>
            </div>

            <!-- /section:basics/sidebar.options -->
        </div>
        <!-- /.pull-left -->
    </div>
    <!-- /.ace-settings-box -->
</div>
<!-- /.ace-settings-container -->

<!-- /section:settings.box -->
<div class="page-content-area">

<!-- /.page-header -->
<!--row 1-->
<div class="row">
<div class="col-xs-12">
<!-- PAGE CONTENT BEGINS -->
<!--<row 1 >-->
<div class="row">
<div class="col-lg-12 col-md-12 widget-container-col">
<!-- #section:custom/widget-box -->
<div class="page-header">
    <h1>Add New Challenge</h1>
</div>

<div class="widget-body">
<div class="widget-main">

<form id="goal_creation_form" class="form-horizontal themed">
<fieldset>
<div class="form-group">

    <div class="col-md-3">
        <label for="challenge_name">Name</label>
    </div>
    <div class="col-md-4">
        <input type="text" class="form-control" id="challenge_name"/>
    </div>

</div>

<div class="form-group">

    <div class="col-md-3">
        <label class="control-label" for="criteria_select">Scope</label>
    </div>
    <div class="col-md-9">
        <div class="controls">
            <select id="scope_select" class="with-search col-md-5">
                <option value="default" disabled="disabled" selected="selected">Select one--</option>
                <option value="Organization">Organization</option>
                <option value="Team">Team</option>
                <option value="Player">Player</option>
            </select>
        </div>
    </div>

</div>
<div class="form-group">

    <div class="col-md-3">
        <label class="control-label" for="criteria_select">Criteria</label>
    </div>
    <div class="col-md-9">
        <div class="controls">
            <select id="criteria_select" class="with-search col-md-5">
                <option value="default" disabled="disabled" selected="selected">Select one--</option>
                <option value="Action">Action</option>
                <option value="Subgoal">Sub-Goal</option>
            </select>
        </div>
    </div>

</div>

<!--scope data div:-->

<div id="scope_content_block">
    <!-- html for subgoal and its target value starts -->
    <div class="criteria-content-blocks" id="team_content_block">
        <div class="form-group">

            <div class="col-md-3">
                <label class="control-label" for="Team_select">Team</label>
            </div>
            <div class="col-md-9">
                <div class="controls">
                    <select name="team_name" id="Team_select" class="with-search col-md-5">
                        <!--<option value="tree1">Team 1</option>-->
                        <!--<option  value="tree2">Team 3</option>-->
                        <!--<option  value="tree3">Team 4</option>-->
                        <!--<option value="tree14">Team 2</option>-->
                    </select>
                </div>
            </div>
        </div>
    </div>
    <!--<div class="form-group">-->
    <!--<div class="row">-->
    <!--<div  class="col-md-3">-->
    <!--<label for="player_target_value">Player Value</label>-->
    <!--</div>-->
    <!--<div class="col-md-9">-->
    <!--<input type="text" class="form-control"  id="player_target_value" />-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
</div>
<!-- html for subgoal and its target value ends -->

<!-- html for allowed transactions and its target value starts -->
<div class="criteria-content-blocks" id="scope_player_block">
    <div class="form-group">

        <div class="col-md-3">
            <label class="control-label" for="key_param_select">Select Player</label>
        </div>
        <div class="col-md-9">
            <div class="controls">
                <select id="select_user" class="with-search col-md-5">
                </select>
            </div>
        </div>

    </div>
</div>


<div id="criteria_content_block">
    <!-- html for subgoal and its target value starts -->
    <div class="criteria-content-blocks" id="subgoal_content_block">
        <div class="form-group">

            <div class="col-md-3">
                <label class="control-label" for="subgoal_select">Subgoal</label>
            </div>
            <div class="col-md-9">
                <div class="controls">
                    <select id="subgoal_select" class="with-search col-md-5">
                    </select>
                </div>
            </div>

        </div>
        <div class="form-group">

            <div class="col-md-3">
                <label for="subgoal_target_value">Sub-Goal Target Value</label>
            </div>
            <div class="col-md-4">
                <input type="text" class="form-control" id="subgoal_target_value"/>
            </div>
        </div>

    </div>
    <!-- html for subgoal and its target value ends -->

    <!-- html for allowed transactions and its target value starts -->
    <div class="criteria-content-blocks" id="transaction_content_block">
        <div class="form-group">

            <div class="col-md-3">
                <label class="control-label" for="key_param_select">Select Key Parameter</label>
            </div>
            <div class="col-md-9">
                <div class="controls">
                    <select id="key_param_select" class="with-search col-md-5">
                    </select>
                </div>

            </div>
        </div>
        <div class="form-group">

            <div class="col-md-3">
                <label class="control-label" for="transaction_select">Allowed Transaction</label>
            </div>
            <div class="col-md-9">
                <div class="controls">
                    <select multiple="" id="transaction_select" class="with-search col-md-5">
                    </select>
                </div>

            </div>
        </div>
        <div class="form-group">

            <div class="col-md-3">
                <label for="transaction_target_value">Transaction Target Value</label>
            </div>
            <div class="col-md-4">
                <input type="text" class="form-control" id="transaction_target_value"/>
            </div>
        </div>

    </div>
</div>
<!-- html for allowed transactions and its target value ends -->


<div class="form-group">

    <div class="col-md-3">
        <label class="control-label">Start Date</label>
    </div>
    <div class="col-md-9">
        <div class="input-group col-md-5">
            <input class="form-control date-picker" id="goal-start-date-js" type="text" data-date-format="dd-mm-yyyy" />
																	<span class="input-group-addon">
																		<i class="fa fa-calendar bigger-110"></i>
																	</span>
        </div>


        <p class="help-block">Default datepicker</p>
    </div>

</div>

<div class="form-group">

    <div class="col-md-3">
        <label class="control-label">End Date</label>
    </div>
    <div class="col-md-9">
        <div class="input-group col-md-5">
            <input class="form-control date-picker" id="goal-end-date-js" type="text" data-date-format="dd-mm-yyyy" />
																	<span class="input-group-addon">
																		<i class="fa fa-calendar bigger-110"></i>
																	</span>
        </div>
        <p class="help-block">Default datepicker</p>
    </div>

</div>

<div class="form-group">

    <div class="col-md-3">
        <label for="goal_points">Points</label>
    </div>
    <div class="col-md-4">
        <input type="text" class="form-control" id="goal_points"/>
    </div>

</div>


<div class="form-actions">
    <button type="reset" class="btn medium btn-danger">
        Cancel
    </button>
    <button id="challenge_submit_btn" type="submit" class="btn medium btn-primary">
        Create
    </button>
</div>

</fieldset>
</form>

</div>
</div>


<!-- /section:custom/widget-box -->
</div>


</div>
<!-- /.row 1 end -->

<!-- PAGE CONTENT ENDS -->
</div>
<!-- /.col -->
</div>
<!-- /1 row -->
</div>
<!-- /.page-content-area -->
</div>
<!-- /.page-content -->
</div>
<!-- /.main-content -->


<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
    <i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
</a>
</div>
<!-- /.main-container -->

<!-- basic scripts -->

<!--[if !IE]> -->
<script type="text/javascript">
    window.jQuery || document.write("<script src='assets/js/jquery.min.js'>" + "<" + "/script>");
</script>

<!-- <![endif]-->

<!--[if IE]>
<script type="text/javascript">
    window.jQuery || document.write("<script src='assets/js/jquery1x.min.js'>" + "<" + "/script>");
</script>
<![endif]-->
<script type="text/javascript">
    if ('ontouchstart' in document.documentElement) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
</script>
<script src="assets/js/bootstrap.min.js"></script>

<!-- page specific plugin scripts -->
<script src="assets/js/jquery-ui.custom.min.js"></script>
<script src="assets/js/jquery.ui.touch-punch.min.js"></script>
<script src="assets/js/date-time/bootstrap-datepicker.min.js"></script>

<!-- ace scripts -->
<script src="assets/js/ace-elements.min.js"></script>
<script src="assets/js/ace.min.js"></script>

<!-- inline scripts related to this page -->

<script src="assets/js/app/app_config.js"></script>
<script type="text/javascript">

var urlParams = JSON.parse(localStorage.getItem('user_data'));
var actionsJSON = "";
var criteria_val = "";
var scope_val = "";
function employee_name() {
    $.ajax({
        url: remote_host+"org/"+urlParams.orgId+"/users/"+urlParams.userId,
//            url: remote_host + "abilities",
        type: 'GET',
        dataType: 'json',
        success: function (res) {
            $("#user_name").text(res.name);
        },
        error: function (e, msg) {
            //processError(e,msg);
        }
    });
}

function get_current_date(){
    var today = new Date();
    var dd = today.getDate();
    var mm = today.getMonth()+1;
    var yyyy = today.getFullYear();

    if(dd < 10){
        dd = '0'+dd;
    }
    if(mm < 10){
        mm = '0'+mm;
    }

    var current_date = dd+'-'+mm+'-'+yyyy;
    return current_date;
}

function set_datepicker_date(date){
    var date_field = $(".date");
    date_field.each(function() {
        $(this).attr("data-date", date);
        $(this).find(".datepicker-input").val(date);
    });
}

function get_employees(){
    $.ajax({
        url: remote_host+"org/"+urlParams.orgId+"/users",
        type: 'GET',
        dataType: 'json',
        success: function(res) {
            if(res){
                var option_html;
                res.forEach(function(user){
                    option_html = "<option value="+user._id+">"+user.name+"</option>";
                    $('#select_user').append(option_html);
//                    $("#key_param_select").append("<option value="+keyParam+">"+keyParam+"</option>");

                });

            }
        }
        ,
        error: function(e , msg){
            //processError(e,msg);
        }
    });
}

function get_teams(){
    $.ajax({
        url: remote_host+"org/"+urlParams.orgId+"/teams",
        type: 'GET',
        dataType: 'json',
        success: function(res) {
            if(res){
                var option_html;
                res.forEach(function(teams){
//                    console.log(teams);
                    option_html = "<option value="+teams._id+">"+teams.name+"</option>";
                    $('#Team_select').append(option_html);

                });

            }
        }
        ,
        error: function(e , msg){
            //processError(e,msg);
        }
    });
}


var hasTag = function(key_param_val) {
    var i = null;
    var filteredactionsJSON = []
    for (i = 0; actionsJSON.length > i; i += 1) {
        //console.log(actionsJSON[i]);
        if (actionsJSON[i].keyParam === key_param_val) {
            filteredactionsJSON.push(actionsJSON[i]);
            //return actionsJSON[i];
        }
    }
    return filteredactionsJSON;
//        return false;
};

function get_actions(){
    $.ajax({
        // /org/:orgId/transactions
        url: remote_host+"org/"+urlParams.orgId+"/transactions",
        type: 'GET',
        dataType: 'json',
        success: function(res) {
            if(res){
                actionsJSON = res;
                var keyParamArray = [];
                res.forEach(function(transactionMaster, index){
                    //console.log(transactionMaster);
                    if (transactionMaster.keyParam !== undefined) {
                        keyParamArray.push(res[index].keyParam);
                    }
                });

                var uniqueKeyParamArray = [];
                $.each(keyParamArray, function(i, el){
                    if($.inArray(el, uniqueKeyParamArray) === -1) uniqueKeyParamArray.push(el);
                });

                uniqueKeyParamArray.forEach(function(keyParam, index){
                    $("#key_param_select").append("<option value="+keyParam+">"+keyParam+"</option>");
                });

            }
        }
        ,
        error: function(e , msg){
            //processError(e,msg);
        }
    });
}

function get_my_created_goals(){
    $.ajax({
        // /org/:orgId/users/:userId/subgoals
        url: remote_host+"org/"+urlParams.orgId+"/users/"+urlParams.userId+"/subgoals",
        type: 'GET',
        dataType: 'json',
        success: function(res) {
            if(res){
                res.forEach(function(goal){
                    $('#subgoal_select').append("<option value="+goal._id+">"+goal.name+"</option>");
                });
            }
        }
        ,
        error: function(e , msg){
            //processError(e,msg);
        }
    });
}

$(function () {

    if ($('#goal-start-date-js').length){
        $('#goal-start-date-js, #goal-end-date-js').datepicker()
    }

    employee_name();
    get_employees();
    get_actions();
    get_teams();
    get_my_created_goals();

    var today_date = get_current_date();
    set_datepicker_date(today_date);

    $('#key_param_select').on('change', function () {
        $('#transaction_select').empty();
        var key_param_val = $("#key_param_select :selected").val();
        var filtered_actions = hasTag(key_param_val);
        filtered_actions.forEach(function(filtered_action, index){
            $('#transaction_select').append("<option value="+filtered_action._id+">"+filtered_action.name+"</option>");
        });
    });
    $('#criteria_select').on('change', function () {
        criteria_val = $("#criteria_select :selected").val();
        if (criteria_val == "Action") {
            $("#subgoal_content_block").hide();
            $("#transaction_content_block").show();
        }
        else if (criteria_val == "Subgoal") {
//                console.log('hello')
            $("#transaction_content_block").hide();
            $("#subgoal_content_block").show();
        }
        else{
            $("#transaction_content_block").hide();
            $("#subgoal_content_block").hide();
        }
    });


    $('#scope_select').on('change', function () {
        scope_val = $("#scope_select :selected").val();
        if (scope_val == "Organization") {
//                console.log("urlParams");
//                console.log(urlParams.orgId);;
//                $("#subgoal_content_block").hide();
//                $("#transaction_content_block").show();
        }
        else if (scope_val == "Team") {
//                console.log('hello');
            $("#scope_player_block").hide();
            $("#team_content_block").show();
        }
        else if (scope_val == "Player") {
//                console.log('hii')
            $("#team_content_block").hide();
            $("#scope_player_block").show();
        }
        else{
//                $("#transaction_content_block").hide();
//                $("#subgoal_content_block").hide();
        }
    });

    $("#challenge_submit_btn").click(function(e) {
        e.preventDefault();

        var challenge_name = $("#challenge_name").val();
        var org_id=urlParams.orgId;


        var transactionElements = $("#transaction_select :selected");
        var selected_transaction = [];
        $.each(transactionElements,function(index, transactionElement){
            selected_transaction.push($(transactionElement).val());
        });
        var transaction_target_value = $("#transaction_target_value").val();

        var selected_subgoal = $("#subgoal_select :selected").val();
        var team_name = $("#Team_select :selected").val();
        var player_name = $("#select_user :selected").val();

        var subgoal_target_value = $("#subgoal_target_value").val();
        var org_scope={};
        var goal_start_date=$('#goal-start-date-js').val();
        var formatted_start_date = new Date(parseInt(goal_start_date.split("-")[2]), parseInt(goal_start_date.split("-")[1])-1, parseInt(goal_start_date.split("-")[0]));
        var goal_end_date=  $('#goal-end-date-js').val();
        var formatted_end_date = new Date(parseInt(goal_end_date.split("-")[2]), parseInt(goal_end_date.split("-")[1])-1, parseInt(goal_end_date.split("-")[0]));

        var goal_points = $("#goal_points").val();
        var data = {}, action_data = {}, subgoal_data = {};
        var entity;
        var scope;
        if (scope_val == "Organization") {
//            org_scope= {
//                scope: "Organization",
            entity= org_id
            scope='organization'
//            };
        }
        if(scope_val == "Team"){
//            org_scope= {
//                scope: "Team",
            entity= team_name,
                    scope='team'

//            };
        }
        if(scope_val == "Player"){
//            org_scope= {
//                scope: "Player",
            entity= player_name,
                    scope='player'

//            };
        }
        console.log(org_scope);
        if (criteria_val == "Action") {
            action_data = {
                scope:scope,
                entity:entity,
                name: challenge_name,
                criteria: criteria_val,
                startDate: formatted_start_date,
                endDate: formatted_end_date,
                action:{
                    allowedTransactions: selected_transaction,
                    targetValue: transaction_target_value
                },
                pointsFn: "function(t){return "+goal_points+";}",
                creator: urlParams.userId
            };
            data = action_data;
        }
        else if (criteria_val == "Subgoal") {
            subgoal_data = {
                scope:scope,
                entity:entity,
                name: challenge_name,
                criteria: criteria_val,
                startDate: formatted_start_date,
                endDate: formatted_end_date,
                subgoals:[{
                    subgoal: selected_subgoal,
                    targetValue: subgoal_target_value
                }],
                pointsFn: "function(t){return "+goal_points+";}",
                creator: urlParams.userId
            };
            data = subgoal_data;
        }

        console.log("data");
        console.log(data);

        $.ajax({
            // /org/:orgId/users/:userId/goals
            url: remote_host+"org/"+urlParams.orgId+"/challenges",
            type: 'POST',
            dataType: 'json',
            data: data,
            success: function(res) {
                var success_text = "Goal assigned to user.";
                console.log('data');
                window.location.href = local_host+"challenges_test_page.html?showNoti="+success_text;
            } ,
            error: function(e , msg){
                //processError(e,msg);
            }
        });

        return false;
    });

});



jQuery(function ($) {

    $('#simple-colorpicker-1').ace_colorpicker({pull_right: true}).on('change', function () {
        var color_class = $(this).find('option:selected').data('class');
        var new_class = 'widget-box';
        if (color_class != 'default')  new_class += ' widget-color-' + color_class;
        $(this).closest('.widget-box').attr('class', new_class);
    });


    // scrollables
    $('.scrollable').each(function () {
        var $this = $(this);
        $(this).ace_scroll({
            size: $this.data('size') || 100
            //styleClass: 'scroll-left scroll-margin scroll-thin scroll-dark scroll-light no-track scroll-visible'
        });
    });
    $('.scrollable-horizontal').each(function () {
        var $this = $(this);
        $(this).ace_scroll(
                {
                    horizontal: true,
                    styleClass: 'scroll-top',//show the scrollbars on top(default is bottom)
                    size: $this.data('size') || 500,
                    mouseWheelLock: true
                }
        ).css({'padding-top': 12});
    });

    $(window).on('resize.scroll_reset', function () {
        $('.scrollable-horizontal').ace_scroll('reset');
    });
    $('.date-picker').datepicker({
        autoclose: true,
        todayHighlight: true
    })


    $('.date-picker').datepicker({
        autoclose: true,
        todayHighlight: true
    })
        //show datepicker when clicking on the icon
            .next().on(ace.click_event, function(){
                $(this).prev().focus();
            });

    //or change it into a date range picker
    $('.input-daterange').datepicker({autoclose:true});

    /**
     //or use slimScroll plugin
     $('.slim-scrollable').each(function () {
					var $this = $(this);
					$this.slimScroll({
						height: $this.data('height') || 100,
						railVisible:true
					});
				});
     */


    /**$('.widget-box').on('setting.ace.widget' , function(e) {
					e.preventDefault();
				});*/

    /**
     $('.widget-box').on('show.ace.widget', function(e) {
					//e.preventDefault();
					//this = the widget-box
				});
     $('.widget-box').on('reload.ace.widget', function(e) {
					//this = the widget-box
				});
     */

    //$('#my-widget-box').widget_box('hide');


    // widget boxes
    // widget box drag & drop example

});
</script>

<!-- the following scripts are used in demo only for onpage help and you don't need them -->
<link rel="stylesheet" href="assets/css/ace.onpage-help.css"/>
<link rel="stylesheet" href="docs/assets/js/themes/sunburst.css"/>

<script type="text/javascript"> ace.vars['base'] = '..'; </script>
<script src="assets/js/ace/elements.onpage-help.js"></script>
<script src="assets/js/ace/ace.onpage-help.js"></script>
<script src="docs/assets/js/rainbow.js"></script>
<script src="docs/assets/js/language/generic.js"></script>
<script src="docs/assets/js/language/html.js"></script>
<script src="docs/assets/js/language/css.js"></script>
<script src="docs/assets/js/language/javascript.js"></script>
<script src="assets/js/app/logout.js"></script>
</body>
</html>